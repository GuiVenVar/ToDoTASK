<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="PÃ¡gina desarrollada para TFGS">
        <meta name="author" content="Guillem Ventura">
        <!--<meta http-equiv="refresh" content="30">-->

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" rel="noopener" target="_blank" href="Styles/IndexStyle.css">

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

        <!--Imagenes de LordIcon-->

        <script src="https://cdn.lordicon.com/lusqsztk.js"></script> <!--sideNav Home -->


        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

        <title>Mi TO-DO Task</title>
    </head>
    <body>



        <!--       Llamada a los servicios Firebase :
               Deploy server.
               Deploy Database.
               Deploy Auth.
        -->
        <script type="module">


        // Import the functions you need from the SDKs you need
            import {initializeApp} from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
            import {getAnalytics} from "https://www.gstatic.com/firebasejs/9.6.10/firebase-analytics.js";
            import {DataSnapshot, getDatabase, ref, get, set, child, update, remove, onValue} from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

        // import { } from 'firebase/app-check';
            // TODO: Add SDKs for Firebase products that you want to use
            // https://firebase.google.com/docs/web/setup#available-libraries

            // Your web app's Firebase configuration
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            const firebaseConfig = {
                apiKey: "AIzaSyCw4VX9XmPQuTPclMsoQn3No05MhqckG0A",
            databaseURL: "https://tododaw-default-rtdb.europe-west1.firebasedatabase.app",
            authDomain: "tododaw.firebaseapp.com",
            projectId: "tododaw",
            storageBucket: "tododaw.appspot.com",
            messagingSenderId: "669151393033",
            appId: "1:669151393033:web:08c29e64571ab03b8f0fd8",
            measurementId: "G-XV3GDKTE6J"
        };

            // Initialize Firebase
            const firebase = initializeApp(firebaseConfig);
            const analytics = getAnalytics(firebase);
            const db = getDatabase();
            const taskList = document.getElementById("taskList");
            const loader = document.getElementById("loader");

            function getDataCompletado() {

                loader.style.visibility = "Visible";

            var primera = true;
            /**
            * Reiniciamos el taskList.
            */
            taskList.innerHTML = "";

            const starCountRef = ref(db, 'Tareas/')
        onValue(starCountRef, (snapshot) => {

                taskList.innerHTML += '<a href="/" class="d-flex align-items-center flex-shrink-0 p-3 link-dark text-decoration-none">' +
                ' <span class="fs-5 fw-bold" style="margin-left:1%;" id="taskListCabecera"><i class="fa-solid fa-2xl fa-magnifying-glass" style="color:#81A594"></i>Completadas </span>' +
                '</a>';

            snapshot.forEach(function (childSnap) {

        if (childSnap.val().EstadoTarea == true) {
        if (primera == true) {
                taskList.innerHTML += '<a href="#" class="list-group-item list-group-item-action active py-3 lh-tight" aria-current="true" style="z-index=1;">' +
                '<div class="d-flex w-100 align-items-center justify-content-between">' +
                '<strong class="mb-1">' + childSnap.val().NombreTarea + '</strong>' +
                '<small>' + childSnap.val().FechaCreacionTarea + '</small>' +
                '</div>' +
                '<div class="col-10 mb-1 small">' + childSnap.val().DescripcionTarea + '</div>' +
                '</a>';
            primera = false;
        } else {
                taskList.innerHTML += '<a href="#" class="list-group-item list-group-item-action  py-3 lh-tight" aria-current="true"  style="z-index=1;">' +
                '<div class="d-flex w-100 align-items-center justify-content-between">' +
                '<strong class="mb-1">' + childSnap.val().NombreTarea + '</strong>' +
                '<small>' + childSnap.val().FechaCreacionTarea + '</small>' +
                '</div>' +
                '<div class="col-10 mb-1 small">' + childSnap.val().DescripcionTarea + '</div>' +
                '</a>';
        }
        }
        });

        });

            loader.style.visibility="hidden";
        }

            function getDataPendiente() {

                loader.style.visibility = "Visible";
            var primera = true;
            /**
            * Reiniciamos el taskList.
            */
            taskList.innerHTML = "";

            const starCountRef = ref(db, 'Tareas/')
        onValue(starCountRef, (snapshot) => {

                taskList.innerHTML += '<a href="/" class="d-flex align-items-center flex-shrink-0 p-3 link-dark text-decoration-none">' +
                ' <span class="fs-5 fw-bold" style="margin-left:1%;" id="taskListCabecera"><i class="fa-solid fa-2xl fa-magnifying-glass" style="color:#81A594"></i>Pendientes </span>' +
                '</a>';

            snapshot.forEach(function (childSnap) {

        if (childSnap.val().EstadoTarea == false) {
        if (primera == true) {
                taskList.innerHTML += '<a href="#" class="list-group-item list-group-item-action active py-3 lh-tight" aria-current="true" style="z-index=1;">' +
                '<div class="d-flex w-100 align-items-center justify-content-between">' +
                '<strong class="mb-1">' + childSnap.val().NombreTarea + '</strong>' +
                '<small>' + childSnap.val().FechaCreacionTarea + '</small>' +
                '</div>' +
                '<div class="col-10 mb-1 small">' + childSnap.val().DescripcionTarea + '</div>' +
                '</a>';
            primera = false;
        } else {
                taskList.innerHTML += '<a href="#" class="list-group-item list-group-item-action  py-3 lh-tight" aria-current="true" style="z-index=1;">' +
                '<div class="d-flex w-100 align-items-center justify-content-between">' +
                '<strong class="mb-1">' + childSnap.val().NombreTarea + '</strong>' +
                '<small>' + childSnap.val().FechaCreacionTarea + '</small>' +
                '</div>' +
                '<div class="col-10 mb-1 small">' + childSnap.val().DescripcionTarea + '</div>' +
                '</a>';
        }
        }
        });

        });

            loader.style.visibility="hidden";
        }




            var elementSearchText = document.getElementById("searchText");          
            elementSearchText.oninput = function busquedaPersonalizada(){

                loader.style.visibility = "Visible";

            var primera = true;
            /**
            * Reiniciamos el taskList.
            */
            taskList.innerHTML = "";

            const starCountRef = ref(db, 'Tareas/')
        onValue(starCountRef, (snapshot) => {

                taskList.innerHTML += '<a href="/" class="d-flex align-items-center flex-shrink-0 p-3 link-dark text-decoration-none" id="taskListBusqueda">' +                  
                ' <span class="fs-5 fw-bold" style="margin-left:1%;" id="taskListCabecera"><i class="fa-solid fa-2xl fa-magnifying-glass" style="color:#81A594"></i>Busqueda Personalizada </span>' +
                '</a>';

            snapshot.forEach(function (childSnap) {
   

        if(childSnap.val().NombreTarea.includes(elementSearchText.value)){
        if (primera == true) {
                taskList.innerHTML += '<a href="#" class="list-group-item list-group-item-action active py-3 lh-tight" aria-current="true" style="z-index=1;">' +
                '<div class="d-flex w-100 align-items-center justify-content-between">' +
                '<strong class="mb-1">' + childSnap.val().NombreTarea + '</strong>' +
                '<small>' + childSnap.val().FechaCreacionTarea + '</small>' +
                '</div>' +
                '<div class="col-10 mb-1 small">' + childSnap.val().DescripcionTarea + '</div>' +
                '</a>';
            primera = false;
        } else {
                taskList.innerHTML += '<a href="#" class="list-group-item list-group-item-action  py-3 lh-tight" aria-current="true"  style="z-index=1;">' +
                '<div class="d-flex w-100 align-items-center justify-content-between">' +
                '<strong class="mb-1">' + childSnap.val().NombreTarea + '</strong>' +
                '<small>' + childSnap.val().FechaCreacionTarea + '</small>' +
                '</div>' +
                '<div class="col-10 mb-1 small">' + childSnap.val().DescripcionTarea + '</div>' +
                '</a>';
        }
        }
        });

        });

            loader.style.visibility="hidden";
   
        };

            var elementCompletado = document.getElementById("icoCompletadas");
            elementCompletado.onclick = getDataCompletado;


            var elementPendiente = document.getElementById("icoPendientes");
            elementPendiente.onclick = getDataPendiente;

            getDataPendiente();

        </script>

        <!----->

    <lord-icon
        id="loader"
        src="https://cdn.lordicon.com/ulhdumaq.json" 
        trigger="loop" 
        colors="primary:#121331,secondary:#000000"
        style="width: auto;height: 21%; z-index: 999; margin-left: 40%; margin-top: 45vh;position: fixed;">
    </lord-icon>

    <nav class="navbar navbar-light bg-light" id="navBar"> 
        <div class="container-fluid" id="positionNavbar">
            <a class="navbar-brand">
                <lord-icon
                    src="https://cdn.lordicon.com/pijqcxrg.json"
                    trigger="loop"
                    colors="secondary:#e6e6dc"
                    style="width:50px;height:50px">
                </lord-icon>
            </a>
            <div id="navItems">

                <a href="#" class="nav-link py-3 " title="" data-bs-toggle="tooltip" data-bs-placement="left" data-bs-original-title="Completadas" id="icoCompletadas">
                    <i class="fa-regular fa-2xl fa-calendar-check" style="color:#E6E6DC"></i>

                </a>
                <a href="#" class="nav-link py-3" title="" data-bs-toggle="tooltip" data-bs-placement="center" data-bs-original-title="Pendientes" id="icoPendientes">

                    <i class="fa-regular fa-2xl fa-calendar-xmark" style="color:#E6E6DC"></i>

                </a>
            </div>
            <form class="d-flex">
                <input class="form-control me-2" type="search" placeholder="&#xF002; Identificador" aria-label="Search" style="border:1px solid black; font-family:Arial, FontAwesome" id="searchText">
                <button class="btn btn-outline-success" type="submit" id="searchButton">Buscar</button>
            </form>
        </div>
    </nav>

    <div class="d-flex flex-column align-items-stretch flex-shrink-0 bg-white" id="taskList">

    </div>


</body>


</html>