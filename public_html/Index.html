<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>

    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!--Stylesheet-->
        <link rel="stylesheet" type="text/css" rel="noopener" target="_blank" href="Styles/LoginStyle.css">

        <!-- Bootstrap CSS -->
        <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    </head>

    <body>

        <section class="vh-100" id="containerLogin">
            <div class="container-fluid h-custom">

                <div class="row d-flex justify-content-center align-items-center h-100">
                    <!--
                    <!--Poner una imagen lateral-->
                    <!--                    <div class="col-md-9 col-lg-6 col-xl-5">
                                                <img src="https://i0.wp.com/hipertextual.com/wp-content/uploads/2020/10/hipertextual-que-sirven-huesos-pene-y-que-humanos-no-tienen-2020152983.jpg?fit=1920%2C1280&ssl=1"
                                                     class="img-fluid" alt="Sample image">
                                            </div>-->
                    <div class="col-md-8 col-lg-6 col-xl-4 ">
                        <form>
                            <div class="d-flex flex-row align-items-center justify-content-center justify-content-lg-start">
                                <p class="lead fw-normal mb-0 me-3">Entrar con </p>
                                <button type="button" class="btn btn-primary btn-floating mx-3" id="fbBtn">
                                    <i class="fab fa-facebook-f"></i>
                                </button>
                            </div>

                            <div class="divider d-flex align-items-center my-4">
                                <p class="text-center fw-bold mx-3 mb-0">O quizás...</p>
                            </div>

                            <!-- Email input -->
                            <div class="form-outline mb-4">
                                <label class="form-label" for="formEmail">Correo Electronico</label>
                                <input type="email" id="formEmail"
                                       class="form-control form-control-lg border border-primary"
                                       placeholder="Introduce tu correo electronico" />

                            </div>

                            <!-- Password input -->
                            <div class="form-outline mb-3">

                                <label class="form-label" for="formPwd">Contraseña</label>
                                <input type="password" id="formPwd"
                                       class="form-control form-control-lg border border-primary" placeholder="Contraseña" />
                            </div>

                            <div class="d-flex justify-content-between align-items-center">
                                <!-- Checkbox -->
                                <div class="form-check mb-0">

                                </div>
                                <a href="#!" class="text-body" id="btnForgot">Forgot password?</a>
                            </div>

                            <div class="text-center text-lg-start mt-4 pt-2">
                                <button type="button" class="btn btn-primary btn-lg"
                                        style="padding-left: 2.5rem; padding-right: 2.5rem;" id="btnLogin">Login</button>
                                <p class="small fw-bold mt-2 pt-1 mb-0">Don't have an account? <a href="#!"
                                                                                                  class="link-danger" id="containerBtnRegister">Register</a></p>
                            </div>

                        </form>
                    </div>
                </div>
            </div>
            <div
                class="d-flex flex-column flex-md-row text-center text-md-start justify-content-between py-4 px-4 px-xl-5 bg-primary">
                <!-- Copyright -->
                <div class="text-white mb-3 mb-md-0">
                    Copyright © 2020. All rights reserved.
                </div>
                <!-- Copyright -->

                <!-- Right -->
                <div>
                    <a href="#!" class="text-white me-4">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="#!" class="text-white me-4">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="#!" class="text-white me-4">
                        <i class="fab fa-google"></i>
                    </a>
                    <a href="#!" class="text-white">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                </div>
                <!-- Right -->
            </div>
        </section>
        <div class="container mw-100" id="containerRegister" style="display: block;">
            <div class="row centered-form">


                <div class="col-xs-12 col-sm-12 col-md-3 col-sm-offset-2 col-md-offset-4"></div>
                <div class="col-xs-12 col-sm-12 col-md-6 col-sm-offset-2 col-md-offset-4" style="z-index: 999;">
                    <div class="panel panel-default w-100">
                        <div class="panel-heading">
                            <h3 class="panel-title">Registro
                                <input type="button" value="&#xf00d" id="closeBtnRegister"
                                       style="font-family: FontAwesome; border:none; cursor:pointer; ">
                            </h3>
                        </div>
                        <hr class="dropdown-divider border-info">
                        <div class="panel-body">
                            <form role="form" action="" id="forgotForm">
                                <div class="row">
                                    <div class="col-xs-6 col-sm-6 col-md-6">
                                        <div class="form-group">
                                            <input type="text" name="nombre" id="nombreRegistro"
                                                   class="form-control input-sm" placeholder="Nombre">
                                        </div>
                                    </div>
                                    <div class="col-xs-6 col-sm-6 col-md-6">
                                        <div class="form-group">
                                            <input type="text" name="apellidos" id="apellidosRegistro"
                                                   class="form-control input-sm" placeholder="Apellidos">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-6 col-sm-6 col-md-6">
                                        <div class="form-group">
                                            <input type="date" name="edad" id="edadRegistro" class="form-control input-sm"
                                                   placeholder="Edad">
                                        </div>
                                    </div>
                                    <div class="col-xs-6 col-sm-6 col-md-6">
                                        <div class="form-group">
                                            <input type="text" name="telefono" id="telefonoRegistro"
                                                   class="form-control input-sm" placeholder="Telefono">
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-xs-6 col-sm-6 col-md-6">
                                        <div class="form-group">
                                            <input type="text" name="empresa" id="empresaRegistro"
                                                   class="form-control input-sm" placeholder="Empresa">
                                        </div>
                                    </div>
                                    <div class="col-xs-6 col-sm-6 col-md-6">
                                        <div class="form-group">
                                            <input type="text" name="cargo" id="cargoEmpresaRegistro"
                                                   class="form-control input-sm" placeholder="Cargo en la empresa">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <input type="email" name="email" id="correoRegistro" class="form-control input-sm"
                                           placeholder="Correo Electronico">
                                </div>

                                <div class="row">
                                    <div class="col-xs-6 col-sm-6 col-md-6">
                                        <div class="form-group">
                                            <input type="password" name="password" id="passwordRegistro"
                                                   class="form-control input-sm" placeholder="Contraseña">
                                        </div>
                                    </div>
                                    <div class="col-xs-6 col-sm-6 col-md-6">
                                        <div class="form-group">
                                            <input type="password" name="password_confirmation" id="rtPasswordRegistro"
                                                   class="form-control input-sm" placeholder="Reescribe la contraseña">
                                        </div>
                                    </div>
                                </div>

                                <input type="button" value="Registro" class="btn btn-info btn-block" id="btnRegister">

                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-xs-12 col-sm-12 col-md-3 col-sm-offset-2 col-md-offset-4"></div>
            </div>
        </div>
        <div class="container mw-100" id="containerForgot" style="display: block;">
            <div class="row centered-form mw-100">
                <div class="col-sm-3 col-md-4 col-sm-offset-2 col-md-offset-4"></div>
                <div class="col-xs-12 col-sm-6 col-md-4 col-sm-offset-2 col-md-offset-4">
                    <div class="panel panel-default w-100">
                        <div class="panel-heading">
                            <h3 class="panel-title">Recupera tu cuenta
                                <input type="button" value="&#xf00d" id="closeBtnForgot"
                                       style="font-family: FontAwesome; border:none; cursor:pointer; ">
                            </h3>
                        </div>
                        <hr class="dropdown-divider border-info">
                        <div class="panel-body">
                            <form role="form" action="" id="registerForm">
                                <div class="form-group">
                                    <input type="email" name="email" id="correoForgot" class="form-control input-sm"
                                           placeholder="Correo Electronico">
                                </div>
                                <input type="button" value="Recuperar cuenta" class="btn btn-info btn-block"
                                       id="btnSendForgot">
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-sm-3 col-md-4 col-sm-offset-2 col-md-offset-4"></div>
            </div>
        </div>

        <script type="module">

            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
            import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-analytics.js";
            import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, sendPasswordResetEmail, getRedirectResult, signInWithPopup, FacebookAuthProvider } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
            import { DataSnapshot, getDatabase, ref, get, set, child, update, remove, onValue } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

            const firebaseConfig = {
            apiKey: "AIzaSyCw4VX9XmPQuTPclMsoQn3No05MhqckG0A",
            databaseURL: "https://tododaw-default-rtdb.europe-west1.firebasedatabase.app",
            authDomain: "tododaw.firebaseapp.com",
            projectId: "tododaw",
            storageBucket: "tododaw.appspot.com",
            messagingSenderId: "669151393033",
            appId: "1:669151393033:web:08c29e64571ab03b8f0fd8",
            measurementId: "G-XV3GDKTE6J"
            };

            // Initialize Firebase
            const firebase = initializeApp(firebaseConfig);
            const analytics = getAnalytics(firebase);
            const db = getDatabase();

            var btnLogin = document.getElementById("btnLogin");
            var btnRegister = document.getElementById("btnRegister");
            var btnSendForgot = document.getElementById("btnSendForgot");
            var btnFb = document.getElementById("fbBtn");

            function logIn() {

            const auth = getAuth();

            var formEmail = document.getElementById("formEmail");
            var formPwd = document.getElementById("formPwd");

            if (formEmail.value != "" && formPwd != "") {

            signInWithEmailAndPassword(auth, formEmail.value, formPwd.value)
            .then((userCredential) => {
            // Signed in
            const user = userCredential.user;

            window.location.href = "Pages\\mainPage.html";

            })
            .catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;

            console.log(error.message);
            alert("Usuario o contraseña incorrectas ! ");
            });
            }
            else {
            alert("Usuario o contraseña vacías");
            }
            }


            function registerUser() {

            var textNombre = document.getElementById("nombreRegistro");
            var textApellidos = document.getElementById("apellidosRegistro");
            var textEdad = document.getElementById("edadRegistro");
            var textTelefono = document.getElementById("telefonoRegistro");
            var textEmpresa = document.getElementById("empresaRegistro");
            var textCargo = document.getElementById("cargoEmpresaRegistro");
            var textEmail = document.getElementById("correoRegistro");
            var textPwd = document.getElementById("passwordRegistro");
            var textRetypePwd = document.getElementById("rtPasswordRegistro");

            var isVerified = true;

            const auth = getAuth();

            if (textNombre.value == "") {
            textNombre.style.border = "1px solid red";
            isVerified = false;
            } else {
            textNombre.style.border = "none";
            isVerified = true;
            }
            if (textApellidos.value == "") {
            textApellidos.style.border = "1px solid red";
            isVerified = false;
            } else {
            textApellidos.style.border = "none";
            isVerified = true;
            }
            if (textEdad.value == "") {
            textEdad.style.border = "1px solid red";
            isVerified = false;
            } else {
            textEdad.style.border = "none";
            isVerified = true;
            }
            if (textTelefono.value == "") {
            textTelefono.style.border = "1px solid red";
            isVerified = false;
            } else {
            textTelefono.style.border = "none";
            isVerified = true;
            }
            if (textEmpresa.value == "") {
            textEmpresa.style.border = "1px solid red";
            isVerified = false;
            } else {
            textEmpresa.style.border = "none";
            isVerified = true;
            }
            if (textCargo.value == "") {
            textCargo.style.border = "1px solid red";
            isVerified = false;
            } else {
            textCargo.style.border = "none";
            isVerified = true;
            }
            if (textEmail.value == "") {
            textEmail.style.border = "1px solid red";
            isVerified = false;
            } else {
            textEmail.style.border = "none";
            isVerified = true;
            }
            if (textPwd.value == "") {
            textPwd.style.border = "1px solid red";
            isVerified = false;
            } else {
            textPwd.style.border = "none";
            isVerified = true;
            }
            if (textRetypePwd.value == "") {
            textRetypePwd.style.border = "1px solid red";
            isVerified = false;
            } else {
            textRetypePwd.style.border = "none";
            isVerified = true;
            }

            if (textPwd.value != textRetypePwd.value && isVerified) {

            textPwd.style.border = "1px solid red";
            textRetypePwd.style.border = "1px solid red";
            alert("Las contraseñas no coinciden.");
            isVerified = false;
            }

            if (isVerified) {
            createUserWithEmailAndPassword(auth, textEmail.value, textRetypePwd.value)
            .then((userCredential) => {
            // Signed in
            const user = userCredential.user;


            // Aqui añadimos los datos del usuario como dato en BBDD
console.log("USERID " + user.uid);
            set(ref(getDatabase(), 'Usuarios/' + user.uid), {
            ApellidosUsuario:document.getElementById("apellidosRegistro").value,
            BibliografiaUsuario:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer a lacus posuere odio sollicitudin ornare. Aenean lectus tellus, porttitor convallis venenatis non, pulvinar eu arcu. Etiam eget velit pulvinar, eleifend enim varius, tincidunt ipsum. In ut ornare nulla. Vestibulum et sem in felis suscipit faucibus. Etiam eu elit lobortis, tincidunt diam vel, tristique magna. Pellentesque ullamcorper neque at lacinia sollicitudin. Aenean felis eros, auctor a magna quis, fermentum lacinia enim. Etiam bibendum arcu at mi vulputate, at placerat sapien fringilla. In hac habitasse platea dictumst. Suspendisse sit amet lobortis mauris, eget rutrum nisi. Curabitur volutpat mi facilisis, euismod ligula in, ornare lorem.",
            CargoUsuario:document.getElementById("cargoEmpresaRegistro").value,
            CorreoUsuario:document.getElementById("correoRegistro").value,
            EdadUsuario:document.getElementById("edadRegistro").value,
            EmpresaUsuario:document.getElementById("empresaRegistro").value,
            IDUsuario:user.uid,
            NombreUsuario:document.getElementById("nombreRegistro").value,
            PhotoPathUsuario:"/",
            TelefonoUsuario:document.getElementById("telefonoRegistro").value,
            VisibilidadUsuario:false
            })
           .then( () =>{
                 window.location.href = "Pages\\mainPage.html";
            });    
            })
            .catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;
            console.log("Fallo => " + errorMessage);
            
            // ..
            });
            } else {
            alert("Verifica los datos");

            }
            }

            function restorePassword() {

            var textEmail = document.getElementById("correoForgot");

            if (textEmail.value != "") {

            const auth = getAuth();

            sendPasswordResetEmail(auth,
            textEmail.value)
            .then(function () {
            alert("Se ha enviado un correo de recuperación !")
            })
            .catch(function (error) {
            alert(error + ": Ha habido un fallo en la recuperación")
            });
            } else {
            textEmail.style.border = "1px solid red";
            alert("No puede estár el campo del correo vacío");
            }
            }

            function loginFacebook() {

            // Sign in using a popup.
            var provider = new FacebookAuthProvider();
            const auth = getAuth();
            provider.addScope('user_birthday');
            signInWithPopup(auth, provider).then(function (result) {
            // This gives you a Facebook Access Token.
            var token = result.credential.accessToken;
            // The signed-in user info.
            var user = result.user;
            });
            }

            btnFb.onclick = loginFacebook;
            btnLogin.onclick = logIn;
            btnRegister.onclick = registerUser;
            btnSendForgot.onclick = restorePassword;

        </script>

        <script type="text/javascript">

var loginContainer = document.getElementById("containerLogin");
var registerContainer = document.getElementById("containerRegister");
var forgotContainer = document.getElementById("containerForgot");
var registerButton = document.getElementById("containerBtnRegister");
var closeBtnRegister = document.getElementById("closeBtnRegister");
var closeBtnForgot = document.getElementById("closeBtnForgot");
var btnRegistro = document.getElementById("btnRegister");
var btnForgot = document.getElementById("btnForgot");



function loadRegister() {

    loginContainer.style.pointerEvents = "none";
    registerContainer.style.display = "block";

}

function loadForgot() {

    loginContainer.style.pointerEvents = "none";
    forgotContainer.style.display = "block";

}
function loadLogin() {
    loginContainer.style.pointerEvents = "all";
    registerContainer.style.display = "none";
    forgotContainer.style.display = "none";
}


btnForgot.onclick = loadForgot;
registerButton.onclick = loadRegister;
closeBtnRegister.onclick = loadLogin;
closeBtnForgot.onclick = loadLogin;

loadLogin();


        </script>
    </body>

</html>