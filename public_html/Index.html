<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Página desarrollada para TFGS">
        <meta name="author" content="Guillem Ventura">
        <!--<meta http-equiv="refresh" content="30">-->

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" rel="noopener" target="_blank" href="Styles/IndexStyle.css">

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

        <!--Imagenes de LordIcon-->

        <script src="https://cdn.lordicon.com/lusqsztk.js"></script> <!--sideNav Home -->


        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

        <!-- Google Fonts --> 
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@700&display=swap" rel="stylesheet">

        <title>Mi TO-DO Task</title>
    </head>
    <body>



        <!--       Llamada a los servicios Firebase :
               Deploy server.
               Deploy Database.
               Deploy Auth.
        -->
        <script type="module">
// Import the functions you need from the SDKs you need
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-analytics.js";
import { DataSnapshot, getDatabase, ref, get, set, child, update, remove, onValue } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";

// import { } from 'firebase/app-check';
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
    apiKey: "AIzaSyCw4VX9XmPQuTPclMsoQn3No05MhqckG0A",
    databaseURL: "https://tododaw-default-rtdb.europe-west1.firebasedatabase.app",
    authDomain: "tododaw.firebaseapp.com",
    projectId: "tododaw",
    storageBucket: "tododaw.appspot.com",
    messagingSenderId: "669151393033",
    appId: "1:669151393033:web:08c29e64571ab03b8f0fd8",
    measurementId: "G-XV3GDKTE6J"
};

// Initialize Firebase
const firebase = initializeApp(firebaseConfig);
const analytics = getAnalytics(firebase);
const db = getDatabase();
const loader = document.getElementById("loader");
console.log(getAuth());

function loadData(element, estadoTarea) {

    loader.style.visibility = "Visible";

    element.innerHTML = "";
    var miHTML = "";

    const starCountRef = ref(db, 'Tareas/')
    onValue(starCountRef, (snapshot) => {

        miHTML += 
            '<div class="d-flex flex-column align-items-stretch flex-shrink-0 bg-white" id="taskList">'+
            '<a href="/" class="d-flex align-items-center flex-shrink-0 p-3 link-dark text-decoration-none">';

switch(estadoTarea){
    case true:
        miHTML += 
            '<span class="fs-5 fw-bold" style="margin-left:1%;" id="taskListCabecera">'+
            '<i class="fa-solid fa-2xl fa-magnifying-glass" style="color:#81A594"></i>Completadas </span>' +
            '</a>';
        break;
    case false:
                miHTML += 
            '<span class="fs-5 fw-bold" style="margin-left:1%;" id="taskListCabecera">'+
            '<i class="fa-solid fa-2xl fa-magnifying-glass" style="color:#81A594"></i>Pendientes </span>' +
            '</a>';
        break;
    default:
                miHTML += 
            '<span class="fs-5 fw-bold" style="margin-left:1%;" id="taskListCabecera">'+
            '<i class="fa-solid fa-2xl fa-magnifying-glass" style="color:#81A594"></i>Públicas </span>' +
            '</a>';
        break;
}

        snapshot.forEach(function (childSnap) {

            if (childSnap.val().EstadoTarea == estadoTarea || estadoTarea == "Publicas") {

                miHTML += 
                    '<a href="#" class="list-group-item list-group-item-action  py-3 lh-tight" aria-current="true"  style="z-index=1;">' +
                    '<div class="d-flex w-100 align-items-center justify-content-between">' +
                    '<strong class="mb-1">' + childSnap.val().NombreTarea + '</strong>' +
                    '<small>' + childSnap.val().FechaCreacionTarea + '</small>' +
                    '</div>' +
                    '<div class="col-10 mb-1 small">' + childSnap.val().DescripcionTarea + '</div>' +
                    '</a>';

            }
        });

        miHTML += "</div>";
    });
    
    element.innerHTML += miHTML;

    loader.style.visibility = "hidden";
}



/**
 * Search Element.
 */

var elementSearchText = document.getElementById("searchText");
elementSearchText.oninput = function busquedaPersonalizada() {

    loader.style.visibility = "Visible";

    var primera = true;
    
    var element, i, tabcontent;
    tabcontent = document.getElementsByClassName("tabcontent");
    element = document.getElementById("Publicas");
    
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
        tabcontent[i].innerHTML = "";
    }
    element.innerHTML = "";

    const starCountRef = ref(db, 'Tareas/')
    onValue(starCountRef, (snapshot) => {

        element.innerHTML += '<a href="/" class="d-flex align-items-center flex-shrink-0 p-3 link-dark text-decoration-none" id="taskListBusqueda">' +
            ' <span class="fs-5 fw-bold" style="margin-left:1%;" id="taskListCabecera"><i class="fa-solid fa-2xl fa-magnifying-glass" style="color:#81A594"></i>Busqueda Personalizada </span>' +
            '</a>';

        snapshot.forEach(function (childSnap) {


            if (childSnap.val().NombreTarea.includes(elementSearchText.value)) {
                if (primera == true) {
                    element.innerHTML += '<a href="#" class="list-group-item list-group-item-action  py-3 lh-tight" aria-current="true" style="z-index=1;">' +
                        '<div class="d-flex w-100 align-items-center justify-content-between">' +
                        '<strong class="mb-1">' + childSnap.val().NombreTarea + '</strong>' +
                        '<small>' + childSnap.val().FechaCreacionTarea + '</small>' +
                        '</div>' +
                        '<div class="col-10 mb-1 small">' + childSnap.val().DescripcionTarea + '</div>' +
                        '</a>';
                    primera = false;
                } else {
                    element.innerHTML += '<a href="#" class="list-group-item list-group-item-action  py-3 lh-tight" aria-current="true"  style="z-index=1;">' +
                        '<div class="d-flex w-100 align-items-center justify-content-between">' +
                        '<strong class="mb-1">' + childSnap.val().NombreTarea + '</strong>' +
                        '<small>' + childSnap.val().FechaCreacionTarea + '</small>' +
                        '</div>' +
                        '<div class="col-10 mb-1 small">' + childSnap.val().DescripcionTarea + '</div>' +
                        '</a>';
                }
            }
        });

    });

    element.style.display = "block";
    loader.style.visibility = "hidden";

};


function openTasks(evt, taskType) {
    
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");

    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
        tabcontent[i].innerHTML = "";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    evt.style.display = "block";
    evt.className += " active";

    switch (taskType) {
        case "tabLinkCompletadas":
            loadData(document.getElementById("Completadas"), true);
            document.getElementById("Completadas").style.display = "block";
            break;
        case "tabLinkPendientes":
            loadData(document.getElementById("Pendientes"), false);
            document.getElementById("Pendientes").style.display = "block";
            break;
        default:
            loadData(document.getElementById("Publicas"), "Publicas");
            document.getElementById("Publicas").style.display = "block";
            break;

    }

    console.log(evt);

}

var eTablinkPendiente = document.getElementById("tabLinkPendientes");
eTablinkPendiente.onclick = function () { openTasks(eTablinkPendiente, 'tabLinkPendientes'); };

var eTablinkCompletadas = document.getElementById("tabLinkCompletadas");
eTablinkCompletadas.onclick = function () { openTasks(eTablinkCompletadas, 'tabLinkCompletadas'); };

var eTablinkPublicas = document.getElementById("tabLinkPublicas");
eTablinkPublicas.onclick = function () { openTasks(eTablinkPublicas, 'tabLinkPublicas'); };


        </script>

        <!----->

    <lord-icon
        id="loader"
        src="https://cdn.lordicon.com/ulhdumaq.json" 
        trigger="loop" 
        colors="primary:#121331,secondary:#000000"
        style="width: auto;height: 21%; z-index: 999; margin-left: 40%; margin-top: 45vh;position: fixed;">
    </lord-icon>

    <nav class="navbar navbar-light bg-light" id="navBar"> 
        <div class="container-fluid" id="positionNavbar">
            <a class="navbar-brand">
                <lord-icon
                    src="https://cdn.lordicon.com/pijqcxrg.json"
                    trigger="loop"
                    colors="secondary:#e6e6dc"
                    style="width:50px;height:50px">
                </lord-icon>
            </a>
            <div class="tab">
                <button class="tablinks" id="tabLinkPendientes">Pendientes</button>
                <button class="tablinks" id="tabLinkCompletadas">Completadas</button>
                <button class="tablinks" id="tabLinkPublicas">Públicas</button>
            </div>
                            <div class="dropdown text-end">
                    <a href="#" class="d-block link-dark text-decoration-none dropdown-toggle" id="dropdownUser1" data-bs-toggle="dropdown" aria-expanded="false">
                        <img src="https://github.com/mdo.png" alt="mdo" width="32" height="32" class="rounded-circle">
                    </a>
                    <ul class="dropdown-menu text-small" aria-labelledby="dropdownUser1">
                        <li><a class="dropdown-item" href="#">New project...</a></li>
                        <li><a class="dropdown-item" href="#">Settings</a></li>
                        <li><a class="dropdown-item" href="#">Profile</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#">Sign out</a></li>
                    </ul>
                </div>
            <form class="d-flex">
                <input class="form-control me-2" type="search" placeholder="&#xF002; Identificador" aria-label="Search" style="border:1px solid black; font-family:Arial, FontAwesome" id="searchText">

            </form>
            
        </div>
    </nav>




    <!-- Tab content -->
    <div id="Pendientes" class="tabcontent">  

    </div>

    <div id="Completadas" class="tabcontent"> 

    </div>

    <div id="Publicas" class="tabcontent">

    </div>





</body>


</html>