<!doctype html>
<html lang="es">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Página desarrollada para TFGS">
        <meta name="author" content="Guillem Ventura">
        <!--<meta http-equiv="refresh" content="30">-->

        <!-- CSS -->
        <link rel="stylesheet" type="text/css" rel="noopener" target="_blank" href="..\\Styles\\IndexStyle.css">

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>


        <!--Imagenes de LordIcon-->

        <script src="https://cdn.lordicon.com/lusqsztk.js"></script> <!--sideNav Home -->


        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

        <!-- Google Fonts --> 
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@700&display=swap" rel="stylesheet">

        <title>Mi TO-DO Task</title>
    </head>
    <body class="overflow-auto" style="background-color: #E6E6DC;">



        <!--       Llamada a los servicios Firebase :
               Deploy server.
               Deploy Database.
               Deploy Auth.
        -->
        <script type="module">
// Import the functions you need from the SDKs you need
    import {initializeApp} from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import {getAnalytics} from "https://www.gstatic.com/firebasejs/9.6.10/firebase-analytics.js";
    import {DataSnapshot, getDatabase, ref, get, set, child, update, remove, onValue} from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";
    import {getAuth, signOut} from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";

// import { } from 'firebase/app-check';
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
        apiKey: "AIzaSyCw4VX9XmPQuTPclMsoQn3No05MhqckG0A",
    databaseURL: "https://tododaw-default-rtdb.europe-west1.firebasedatabase.app",
    authDomain: "tododaw.firebaseapp.com",
    projectId: "tododaw",
    storageBucket: "tododaw.appspot.com",
    messagingSenderId: "669151393033",
    appId: "1:669151393033:web:08c29e64571ab03b8f0fd8",
    measurementId: "G-XV3GDKTE6J"
};

    // Initialize Firebase
    const firebase = initializeApp(firebaseConfig);
    const analytics = getAnalytics(firebase);
    const db = getDatabase();
    const loader = document.getElementById("loader");
    console.log(getAuth());

function loadData(element, estadoTarea) {

    loader.style.display = "block";

    element.innerHTML = "";

    var divTareasGeneral = document.createElement("div");
    
    var divTareasPrioridadAlta = document.createElement("div");
    divTareasPrioridadAlta.id = "prioridadAlta";
    
    var divTareasPrioridadMedia = document.createElement("div");
    divTareasPrioridadMedia.id = "prioridadMedia";
    
    var divTareasPrioridadBaja = document.createElement("div");
    divTareasPrioridadBaja.id = "prioridadBaja";
    
    var cajaTareas = document.createElement("a");

    const starCountRef = ref(db, 'Tareas/')
    onValue(starCountRef, (snapshot) => {

        divTareasGeneral.className = "d-flex flex-column align-items-stretch flex-shrink-0 bg-white";
        divTareasGeneral.id = "taskList";

        cajaTareas.innerHTML = "";
        cajaTareas.href = "#";
        cajaTareas.className = "d-flex align-items-center flex-shrink-0 p-3 link-dark text-decoration-none";

        var spanCabeceraTarea = document.createElement("span");
        spanCabeceraTarea.className = "fs-5 fw-bold";
        spanCabeceraTarea.style.marginLeft = "1%";
        spanCabeceraTarea.id = "taskListCabecera";

        var textoCabecera = document.createElement("i");

        switch (estadoTarea) {
            case true:

                textoCabecera.className = "fa-solid fa-2xl fa-magnifying-glass";
                textoCabecera.style.color = "#81A594";
                spanCabeceraTarea.appendChild(textoCabecera);
                spanCabeceraTarea.innerHTML += "Completadas";

                break;
            case false:

                textoCabecera.className = "fa-solid fa-2xl fa-magnifying-glass";
                textoCabecera.style.color = "#81A594";
                spanCabeceraTarea.appendChild(textoCabecera);
                spanCabeceraTarea.innerHTML += "Pendientes";

                break;
            default:

                textoCabecera.className = "fa-solid fa-2xl fa-magnifying-glass";
                textoCabecera.style.color = "#81A594";
                spanCabeceraTarea.appendChild(textoCabecera);
                spanCabeceraTarea.innerHTML += "Públicas";

                break;
        }

        /**
         * Aqui unimos  el div general al "a" de la cabecera
         */

        cajaTareas.appendChild(spanCabeceraTarea);
       
 
        /**
         * Hasta aqui hemos generado la cabecera donde aparece el nombre del tipo de busqueda 
         * - Pendientes
         * - Completadas
         * - Públicas
         */

        snapshot.forEach(function (childSnap) {

            var bloqueTareas = document.createElement("a");
            bloqueTareas.href = "#";
            bloqueTareas.className = "list-group-item list-group-item-action py-3 lh-tight";
            bloqueTareas.id = "bloqueTareas";
            bloqueTareas.ariaCurrent = "true";
            bloqueTareas.style.zIndex = "1";

            if (childSnap.val().EstadoTarea == estadoTarea || estadoTarea == "Publicas") {

                var divTareaButtons = document.createElement("div");
                divTareaButtons.className = "multi-button";
                divTareaButtons.id = "multiButton";

                var btnHeart = document.createElement("button");
                btnHeart.className = "fas fa-heart";

                var btnComment = document.createElement("button");
                btnComment.className = "fas fa-comment";

                var btnShare = document.createElement("button");
                btnShare.className = "fas fa-share-alt";

                var btnTrash = document.createElement("button");
                btnTrash.className = "fas fa-trash";

                divTareaButtons.appendChild(btnHeart);
                divTareaButtons.appendChild(btnComment);
                divTareaButtons.appendChild(btnShare);
                divTareaButtons.appendChild(btnTrash);

                var divDetallesTareas = document.createElement("div");
                divDetallesTareas.className = "d-flex w-100 align-items-center justify-content-between";


                var cabeceraDetalleTarea = document.createElement("strong");
                cabeceraDetalleTarea.className = "mb-1";
                cabeceraDetalleTarea.innerHTML += childSnap.val().NombreTarea;

                var fechaTarea = document.createElement('small');
                fechaTarea.innerHTML += childSnap.val().FechaCreacionTarea;

                divDetallesTareas.appendChild(cabeceraDetalleTarea);
                divDetallesTareas.appendChild(fechaTarea);

                var divDescripcionTarea = document.createElement("div");
                divDescripcionTarea.className = "col-10 mb-1 small";
                divDescripcionTarea.innerHTML += childSnap.val().DescripcionTarea;

                bloqueTareas.appendChild(divTareaButtons);
                bloqueTareas.appendChild(divDetallesTareas);
                bloqueTareas.appendChild(divDescripcionTarea);


                bloqueTareas.onmouseover = function () {

                    bloqueTareas.style.backgroundColor = "aliceblue";
                    bloqueTareas.firstChild.style.display = "block";
                }

                bloqueTareas.onmouseout = function () {

                    bloqueTareas.style.backgroundColor = "white";
                    bloqueTareas.firstChild.style.display = "none";
                }

                var divider = document.createElement("div");
                divider.className = "divider d-flex";
                divider.style.height = "5px";

                switch (childSnap.val().PrioridadTarea) {
                    case "Alta":
                        bloqueTareas.style.borderLeft = "5px solid red";                        
                        divTareasPrioridadAlta.appendChild(bloqueTareas);
                        divTareasPrioridadAlta.appendChild(divider);
                        break;
                    case "Media":
                        bloqueTareas.style.borderLeft = "5px solid yellow";
                        divTareasPrioridadMedia.appendChild(bloqueTareas);                        
                        divTareasPrioridadMedia.appendChild(divider);
                        break;
                    case "Baja":
                        bloqueTareas.style.borderLeft = "5px solid green";
                        divTareasPrioridadBaja.appendChild(bloqueTareas);                        
                        divTareasPrioridadBaja.appendChild(divider);
                        break;
                }
            }      
        });
    });
    
    
    divTareasGeneral.appendChild(divTareasPrioridadAlta);
    divTareasGeneral.appendChild(divTareasPrioridadMedia);
    divTareasGeneral.appendChild(divTareasPrioridadBaja);
    element.appendChild(cajaTareas);
    element.appendChild(divTareasGeneral);

    loader.style.display = "none";
}

/**
* Search Element.
*/

var elementSearchText = document.getElementById("searchText");
elementSearchText.oninput = function busquedaPersonalizada() {

    loader.style.visibility = "Visible";

    var element, i, tabcontent;
    tabcontent = document.getElementsByClassName("tabcontent");
    element = document.getElementById("Publicas");
    var divTareasGeneral = document.createElement("div");

    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
        tabcontent[i].innerHTML = "";
    }


    const starCountRef = ref(db, 'Tareas/')
    onValue(starCountRef, (snapshot) => {

        divTareasGeneral.className = "d-flex flex-column align-items-stretch flex-shrink-0 bg-white";
        divTareasGeneral.id = "taskList";

        var cajaTareas = document.createElement("a");
        cajaTareas.href = "#";
        cajaTareas.className = "d-flex align-items-center flex-shrink-0 p-3 link-dark text-decoration-none";

        var spanCabeceraTarea = document.createElement("span");
        spanCabeceraTarea.className = "fs-5 fw-bold";
        spanCabeceraTarea.style.marginLeft = "1%";
        spanCabeceraTarea.id = "taskListCabecera";

        var textoCabecera = document.createElement("i");
        textoCabecera.className = "fa-solid fa-2xl fa-magnifying-glass";
        textoCabecera.style.color = "#81A594";
        spanCabeceraTarea.appendChild(textoCabecera);
        spanCabeceraTarea.innerHTML += "Busqueda personalizada";

        /**
         * Hasta aqui hemos generado la cabecera donde aparece el nombre del tipo de busqueda 
         * - Pendientes
         * - Completadas
         * - Públicas
         */

        cajaTareas.appendChild(spanCabeceraTarea);
        divTareasGeneral.appendChild(cajaTareas);

        snapshot.forEach(function (childSnap) {

            var bloqueTareas = document.createElement("a");
            bloqueTareas.href = "#";
            bloqueTareas.className = "list-group-item list-group-item-action py-3 lh-tight";
            bloqueTareas.id = "bloqueTareas";
            bloqueTareas.ariaCurrent = "true";
            bloqueTareas.style.zIndex = "1";
            
                        switch(childSnap.val().PrioridadTarea){
                case "Alta":
                    bloqueTareas.style.borderLeft = "5px solid red";
                    break;
                case "Media":                    
                    bloqueTareas.style.borderLeft = "5px solid yellow";
                    break;                              
                case "Baja":                    
                    bloqueTareas.style.borderLeft = "5px solid green";
                    break;
            }

            if (childSnap.val().NombreTarea.toLowerCase().includes(elementSearchText.value.toLowerCase())) {

                var divTareaButtons = document.createElement("div");
                divTareaButtons.className = "multi-button";
                divTareaButtons.id = "multiButton";

                var btnHeart = document.createElement("button");
                btnHeart.className = "fas fa-heart";

                var btnComment = document.createElement("button");
                btnComment.className = "fas fa-comment";

                var btnShare = document.createElement("button");
                btnShare.className = "fas fa-share-alt";

                var btnTrash = document.createElement("button");
                btnTrash.className = "fas fa-trash";

                divTareaButtons.appendChild(btnHeart);
                divTareaButtons.appendChild(btnComment);
                divTareaButtons.appendChild(btnShare);
                divTareaButtons.appendChild(btnTrash);

                var divDetallesTareas = document.createElement("div");
                divDetallesTareas.className = "d-flex w-100 align-items-center justify-content-between";


                var cabeceraDetalleTarea = document.createElement("strong");
                cabeceraDetalleTarea.className = "mb-1";
                cabeceraDetalleTarea.innerHTML += childSnap.val().NombreTarea;

                var fechaTarea = document.createElement('small');
                fechaTarea.innerHTML += childSnap.val().FechaCreacionTarea;

                divDetallesTareas.appendChild(cabeceraDetalleTarea);
                divDetallesTareas.appendChild(fechaTarea);

                var divDescripcionTarea = document.createElement("div");
                divDescripcionTarea.className = "col-10 mb-1 small";
                divDescripcionTarea.innerHTML += childSnap.val().DescripcionTarea;

                bloqueTareas.appendChild(divTareaButtons);
                bloqueTareas.appendChild(divDetallesTareas);
                bloqueTareas.appendChild(divDescripcionTarea);


                bloqueTareas.onmouseover = function () {

                    bloqueTareas.style.backgroundColor = "aliceblue";
                    bloqueTareas.firstChild.style.display = "block";
                }

                bloqueTareas.onmouseout = function () {

                    bloqueTareas.style.backgroundColor = "white";
                    bloqueTareas.firstChild.style.display = "none";
                }
                
                var divider = document.createElement("div");      
                divider.className = "divider d-flex";
                divider.style.height = "5px";
                
                divTareasGeneral.appendChild(divider);                
                divTareasGeneral.appendChild(bloqueTareas);
             
            }
        });

    });

    element.appendChild(divTareasGeneral);
    
    element.style.display = "block";
    loader.style.visibility = "hidden";

};

function openTasks(evt, taskType) {

    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");

    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
        tabcontent[i].innerHTML = "";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    
    evt.style.display = "block";
    evt.className += " active";

    switch (taskType) {
        case "tabLinkCompletadas":
            loadData(document.getElementById("Completadas"), true);
            document.getElementById("Completadas").style.display = "block";
            break;
        case "tabLinkPendientes":
            loadData(document.getElementById("Pendientes"), false);
            document.getElementById("Pendientes").style.display = "block";
            break;
        default:
            loadData(document.getElementById("Publicas"), "Publicas");
            document.getElementById("Publicas").style.display = "block";
            break;

    }
}


function deleteTask(){}
function completeTask(){}
function setToPublic(){}
function setToPrivate(){}
function setHighPriority(){}
function setMidPriority(){}
function setLowPriority(){}
function createTask(){}




function UserSignOut() {

    const auth = getAuth();
    signOut(auth).then(() => {
        window.location.href = "..\\Index.html";
        alert("Se ha desconectado !");
    }).catch((error) => {
        console.log("Error desconectando !");
    });

}

var btnSignOut = document.getElementById("signOut");
btnSignOut.onclick = function () { UserSignOut() };

var eTablinkPendiente = document.getElementById("tabLinkPendientes");
eTablinkPendiente.onclick = function () { openTasks(eTablinkPendiente, 'tabLinkPendientes');};

var eTablinkCompletadas = document.getElementById("tabLinkCompletadas");
eTablinkCompletadas.onclick = function () { openTasks(eTablinkCompletadas, 'tabLinkCompletadas');};

var eTablinkPublicas = document.getElementById("tabLinkPublicas");
eTablinkPublicas.onclick = function () { openTasks(eTablinkPublicas, 'tabLinkPublicas');};

openTasks(document.getElementById("Publicas"), "Publicas");

</script >

        <script type="text/javascript">


function multiButtonHover(element) {
    var firstchild = element.firstChild;
    firstchild.style.display = "block";
    element.style.backgroundColor = "aliceblue";
}

function removeButtonHover(element) {
    var firstchild = element.firstChild;
    firstchild.style.display = "none";
    element.style.backgroundColor = "white";

}

        </script>

        <!----->

        <a href="#" class="float">
            <i class="fa fa-plus my-float"></i>
        </a>

        <div class="container mw-100 w-100 h-100" id="loader" style=" display: none;">
            <div class="row centered-form mw-100 w-100 h-100" style="">
                <div class="col-sm-3 col-md-4 col-sm-offset-2 col-md-offset-4"></div>
                <div class="col-xs-12 col-sm-6 col-md-4 col-sm-offset-2 col-md-offset-4 d-flex justify-content-around align-content-around flex-wrap" style="/* display: flex; *//* align-content: space-around; *//* flex-wrap: wrap; */">

                    <lord-icon src="https://cdn.lordicon.com/ulhdumaq.json" trigger="loop" colors="primary:#121331,secondary:#000000" style="width: auto; height: 15%; z-index: 999;  margin-top: auto;  visibility: visible;">
                    </lord-icon>

                </div>
                <div class="col-sm-3 col-md-4 col-sm-offset-2 col-md-offset-4"></div>
            </div>
        </div>


        <nav class="" id="navBar"> 
            <div class="container-fluid" id="positionNavbar">
                <form class="d-flex">
                    <input class="form-control me-2" type="search" placeholder="&#xF002; Identificador" aria-label="Search" style="border:1px solid black; font-family:Arial, FontAwesome" id="searchText">
                </form>

                <div class="tab overflow-hidden d-flex flex-wrap">
                    <button class="tablinks" id="tabLinkPendientes">Pendientes</button>
                    <button class="tablinks" id="tabLinkCompletadas">Completadas</button>
                    <button class="tablinks" id="tabLinkPublicas">Públicas</button>
                </div>

                <div class="dropdown text-end">
                    <a href="#" class="d-block link-dark text-decoration-none dropdown-toggle" id="dropdownUser1" data-bs-toggle="dropdown" aria-expanded="false">
                        <img src="https://github.com/mdo.png" alt="mdo" width="32" height="32" class="rounded-circle">
                    </a>
                    <ul class="dropdown-menu text-small" aria-labelledby="dropdownUser1" id="dropdownUser1">
                        <li><a class="dropdown-item" href="..\Pages\newTask.html">Nuevo Proyecto...</a></li>
                        <li><a class="dropdown-item" href="..\Pages\profile.html">Perfil</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" id="signOut">Cerrar Sesión</a></li>
                    </ul>
                </div>

            </div>
        </nav>




        <!-- Tab content -->
        <div id="Pendientes" class="tabcontent">  

        </div>

        <div id="Completadas" class="tabcontent"> 

        </div>

        <div id="Publicas" class="tabcontent">

        </div>





    </body>


</html>